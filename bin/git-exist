#!/bin/zsh
skip_hidden=0

# Parse flags
while [[ "$1" == -* ]]; do
  case "$1" in
    --no-hidden) skip_hidden=1; shift ;;
    *) echo "Unknown option: $1"; exit 1 ;;
  esac
done

# start directory (default: current directory)
start_dir="${1:-.}"

# search for .git directories
if [[ "$skip_hidden" -eq 1 ]]; then
  find "$start_dir" -name ".*" -not -name ".git" -prune -o -type d -name ".git" -print
else
  find "$start_dir" -type d -name ".git"
fi | while read gitdir; do
    echo "Git repository found: ${gitdir%/.git}"
done
